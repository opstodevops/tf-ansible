---
  - hosts: dc01
    gather_facts: no

    # vars_prompt:
    #   - name: username
    #     prompt: "Enter local username"
    #     private: no
    #   - name: password
    #     prompt: "Enter password"
    
    vars:
      safe_mode_password: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          39616164376432326663626231303866316663623561616263393734383331616632656264303362
          3532383365613036643664376639616139366364613331300a633037633537666537653333666665
          34306638376439663938653337343732653831626365376637653233316639396266616239653663
          6630633061623638380a656563653264366663333730656666616363356362366666376130323265
          64373835396164343739663932616163366432636361343637303638373933356539
      # ansible_user: "{{ username }}"
      # ansible_password: "{{ password }}"
      # ansible_connection: winrm
      # ansible_winrm_transport: ntlm
      # ansible_winrm_server_cert_validation: ignore  
    
    tasks:
      - name: Create new Windows domain in a new forest with specific parameters
        win_domain:
          create_dns_delegation: no
          database_path: C:\Windows\NTDS
          dns_domain_name: opstodevops.tech
          domain_mode: Win2012R2
          domain_netbios_name: OPSTODEVOPS
          forest_mode: Win2012R2
          safe_mode_password: "{{ safe_mode_password }}"
          sysvol_path: C:\Windows\SYSVOL
        register: domain_install
      - debug:
          var: domain_install

      - name: Reboot
        win_reboot:
        when: domain_install.reboot_required

